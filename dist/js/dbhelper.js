class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurants(t){DBHelper.openDatabase().then(function(e){if(!e)return;e.transaction("restaurants").objectStore("restaurants").getAll().then(function(e){t(null,e),fetch(DBHelper.DATABASE_URL).then(t=>t.json()).then(n=>{JSON.stringify(n)!==JSON.stringify(e)&&DBHelper._updateDB(n),t(null,n)}).catch(e=>t(e,null))})})}static fetchRestaurantById(t,e){DBHelper.openDatabase().then(function(n){if(!n)return;let a=n.transaction("restaurants").objectStore("restaurants");const r=parseInt(t);a.get(r).then(function(t){t?e(null,t):fetch(`${DBHelper.DATABASE_URL}/${r}`).then(t=>t.json()).then(t=>{DBHelper._updateDB(t),e(null,t)}).catch(t=>e("Restaurant does not exist or Connection issues",null))})})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((n,a)=>{if(n)e(n,null);else{const n=a.filter(e=>e.cuisine_type==t);e(null,n)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((n,a)=>{if(n)e(n,null);else{const n=a.filter(e=>e.neighborhood==t);e(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,n){DBHelper.fetchRestaurants((a,r)=>{if(a)n(a,null);else{let a=r;"all"!=t&&(a=a.filter(e=>e.cuisine_type==t)),"all"!=e&&(a=a.filter(t=>t.neighborhood==e)),n(null,a)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].neighborhood),a=e.filter((t,n)=>e.indexOf(t)==n);t(null,a)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].cuisine_type),a=e.filter((t,n)=>e.indexOf(t)==n);t(null,a)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static getPhotoDescription(t){return`Photo of ${t.name} in ${t.neighborhood}`}static imageUrlForRestaurant(t,e=!1){return t&&t.photograph?e?`imgs/${t.photograph}-low.jpg`:`imgs/${t.photograph}.jpg`:"imgs/no-pictures.svg"}static imageSRCSetUrlsForRestaurant(t,e){let n=[];return t&&t.photograph&&e.forEach(e=>{n.push(`imgs/${t.photograph}-${e}.jpg ${e}`)}),n.join(", ")}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}static openDatabase(){return navigator.serviceWorker?idb.open("restaurnatsData",1,function(t){t.createObjectStore("restaurants",{keyPath:"id"}).createIndex("by-date","createdAt")}):Promise.resolve()}static _updateDB(t){DBHelper.openDatabase().then(function(e){if(!e)return;var n=e.transaction("restaurants","readwrite").objectStore("restaurants");[].concat(t).forEach(t=>{n.put(t)}),n.index("by-date").openCursor(null,"prev").then(function(t){return t.advance(30)}).then(function t(e){if(e)return e.delete(),e.continue().then(t)})})}static registerServiceWorker(){var t;navigator.serviceWorker&&(navigator.serviceWorker.register("sw.js").then(function(t){navigator.serviceWorker.controller&&(t.waiting?DBHelper._updateReady(t.waiting):t.installing?DBHelper._trackInstalling(t.installing):t.addEventListener("updatefound",function(){DBHelper._trackInstalling(t.installing)}))}),navigator.serviceWorker.addEventListener("controllerchange",function(){t||(window.location.reload(),t=!0)}))}static _trackInstalling(t){t.addEventListener("statechange",function(){"installed"==t.state&&DBHelper._updateReady(t)})}static _updateReady(t){this._toastsView=new Toast,this._toastsView.create("New version available",{buttons:["refresh","dismiss"]}).answer.then(function(e){"refresh"==e&&t.postMessage({action:"skipWaiting"})})}}